generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String                    @id @default(cuid())
  name                   String
  email                  String                    @unique
  password               String
  businessName           String
  phone                  String?
  licenseNumber          String
  licenseState           String
  yearsExperience        String?
  selectedPlan           String                    @default("pro")
  licenseFile            String?
  insuranceFile          String?
  hasActiveSubscription  Boolean                   @default(false)
  isLicenseVerified      Boolean                   @default(false)
  role                   String                    @default("artist")
  stripeId               String?                   @unique
  stripeCustomerId       String?
  stripeSubscriptionId   String?
  subscriptionStatus     String                    @default("inactive")
  createdAt              DateTime                  @default(now())
  updatedAt              DateTime                  @updatedAt
  address                String?
  avatar                 String?
  bio                    String?
  businessHours          String?
  certifications         String?
  experience             String?
  instagram              String?
  specialties            String?
  studioName             String?
  website                String?
  venmoUsername          String?
  cashAppUsername        String?
  stripeConnectAccountId String?                   @unique
  boothRentAmount        Float?
  commissionRate         Float?
  employmentType         String?
  facebook               String?
  tiktok                 String?
  twitter                String?
  youtube                String?
  permissions            Json?
  appointments           Appointment[]
  calendarIntegrations   CalendarIntegration[]
  clients                Client[]
  complaints             Complaint[]
  consentForms           ConsentForm[]
  depositPayments        DepositPayment[]
  fileUploads            FileUpload[]
  formDrafts             FormDraft[]
  invoices               Invoice[]
  magicLinkTokens        MagicLinkToken[]
  metaConnections        MetaConnection[]
  notifications          Notification[]
  orders                 Order[]
  portfolios             Portfolio[]
  procedures             Procedure[]
  products               Product[]
  reviewLinks            ReviewLink[]
  reviews                Review[]
  assignedServices       ServiceAssignment[]       @relation("AssignedByUser")
  serviceAssignments     ServiceAssignment[]       @relation("UserServiceAssignments")
  services               Service[]
  supportTickets         SupportTicket[]
  receivedMessages       TeamMessage[]             @relation("ReceivedMessages")
  sentMessages           TeamMessage[]             @relation("SentMessages")
  timeBlocks             TimeBlock[]
  timeTrackingSessions   TimeTrackingSession[]
  roomBookings           RoomBooking[]
  trainingAssignments    TrainingAssignment[]
  trainingDiscussions    TrainingDiscussion[]
  trainingReplies        TrainingDiscussionReply[]
  weekVideoAssignments   WeekVideoAssignment[]

  @@map("users")
}

model TrainingDiscussion {
  id        String                    @id @default(cuid())
  programId String // 'fundamentals' or 'smp'
  title     String
  content   String
  userId    String
  user      User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
  replies   TrainingDiscussionReply[]
  createdAt DateTime                  @default(now())
  updatedAt DateTime                  @updatedAt

  @@index([programId])
  @@index([userId])
  @@index([createdAt])
  @@map("training_discussions")
}

model TrainingDiscussionReply {
  id           String             @id @default(cuid())
  discussionId String
  discussion   TrainingDiscussion @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  content      String
  userId       String
  user         User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  @@index([discussionId])
  @@index([userId])
  @@index([createdAt])
  @@map("training_discussion_replies")
}

model Client {
  id               String           @id @default(cuid())
  userId           String
  name             String
  email            String?
  phone            String?
  dateOfBirth      DateTime?
  emergencyContact String?
  medicalHistory   String?
  allergies        String?
  skinType         String?
  notes            String?
  isActive         Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  analyses         Analysis[]
  appointments     Appointment[]
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  consentForms     ConsentForm[]
  depositPayments  DepositPayment[]
  documents        Document[]
  fileUploads      FileUpload[]
  formDrafts       FormDraft[]
  intakes          Intake[]
  invoices         Invoice[]
  orders           Order[]
  photos           Photo[]
  procedures       Procedure[]
  reviews          Review[]

  @@map("clients")
}

model Photo {
  id        String     @id @default(cuid())
  clientId  String
  url       String
  filename  String?
  lighting  String?
  quality   String?
  createdAt DateTime   @default(now())
  analyses  Analysis[]
  client    Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("photos")
}

model Intake {
  id           String   @id @default(cuid())
  clientId     String
  conditions   String
  medications  String
  notes        String?
  result       String?
  rationale    String?
  flaggedItems String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  client       Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("intakes")
}

model Analysis {
  id             String   @id @default(cuid())
  clientId       String
  photoId        String?
  fitzpatrick    Int?
  undertone      String?
  confidence     Float?
  recommendation Json?
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  client         Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  photo          Photo?   @relation(fields: [photoId], references: [id])

  @@map("analyses")
}

model Pigment {
  id         String   @id @default(cuid())
  brand      String
  name       String
  baseTone   String
  hueNotes   String
  opacity    String
  idealFitz  String
  tempShift  String?
  useCase    String
  hexPreview String?
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([brand, name])
  @@map("pigments")
}

model MagicLinkToken {
  id        String   @id @default(cuid())
  userId    String
  email     String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("magic_link_tokens")
}

model Document {
  id        String       @id @default(cuid())
  clientId  String
  type      DocumentType
  fileUrl   String
  filename  String?
  fileSize  Int?
  mimeType  String?
  notes     String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  client    Client       @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("documents")
}

model Procedure {
  id                  String       @id @default(cuid())
  userId              String?
  clientId            String
  serviceId           String?
  appointmentId       String?
  procedureType       String
  voltage             Float?
  needleConfiguration String
  needleSize          String?
  pigmentBrand        String
  pigmentColor        String
  lotNumber           String?
  depth               String?
  technique           String?
  duration            Int?
  areaTreated         String?
  notes               String?
  beforePhotos        String?
  afterPhotos         String?
  healingProgress     String?
  procedureDate       DateTime     @default(now())
  followUpDate        DateTime?
  touchUpScheduled    Boolean      @default(false)
  touchUpDate         DateTime?
  isCompleted         Boolean      @default(false)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  appointment         Appointment? @relation(fields: [appointmentId], references: [id])
  client              Client       @relation(fields: [clientId], references: [id], onDelete: Cascade)
  service             Service?     @relation(fields: [serviceId], references: [id])
  user                User?        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([clientId])
  @@index([procedureType])
  @@index([procedureDate])
  @@map("procedures")
}

model MetaConnection {
  id                 String    @id @default(cuid())
  userId             String
  pageId             String
  pageName           String
  pageAccessToken    String
  pageTokenExpiresAt DateTime?
  igUserId           String?
  igUsername         String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, pageId])
  @@index([userId])
  @@map("meta_connections")
}

model RoomBooking {
  id          String   @id @default(cuid())
  userId      String
  studioName  String
  roomName    String
  bookingDate DateTime
  startTime   DateTime
  endTime     DateTime
  serviceType String?
  clientName  String?
  notes       String?
  status      String   @default("confirmed")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([studioName])
  @@index([bookingDate])
  @@index([startTime])
  @@index([status])
  @@map("room_bookings")
}

model TrainingAssignment {
  id             String   @id @default(cuid())
  weekId         String
  title          String
  description    String
  dueDateLabel   String
  dueDateISO     String?
  status         String   @default("pending")
  estimatedHours Float?
  rubric         String?
  order          Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdBy      String?
  createdByUser  User?    @relation(fields: [createdBy], references: [id], onDelete: SetNull)
  videoId        String?
  video          FileUpload? @relation(fields: [videoId], references: [id], onDelete: SetNull)

  @@index([weekId])
  @@index([videoId])
  @@map("training_assignments")
}

model WeekVideoAssignment {
  id        String   @id @default(cuid())
  weekId    String   // e.g., "week-1", "week-2", etc.
  videoId   String   // FileUpload.id
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  createdByUser User? @relation(fields: [createdBy], references: [id], onDelete: SetNull)
  video     FileUpload @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([weekId, videoId])
  @@index([weekId])
  @@index([videoId])
  @@map("week_video_assignments")
}

model CalendarIntegration {
  id             String           @id @default(cuid())
  userId         String
  provider       CalendarProvider
  providerName   String
  apiKey         String?
  webhookUrl     String?
  calendarId     String?
  calendarName   String?
  isActive       Boolean          @default(true)
  syncDirection  SyncDirection    @default(BIDIRECTIONAL)
  lastSyncAt     DateTime?
  syncFrequency  Int              @default(15)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  accessToken    String?
  metadata       Json?
  refreshToken   String?
  tokenExpiresAt DateTime?
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, provider, calendarId])
  @@index([userId])
  @@map("calendar_integrations")
}

model DepositPayment {
  id                    String        @id @default(cuid())
  clientId              String
  appointmentId         String?
  userId                String
  amount                Decimal       @db.Decimal(10, 2)
  totalAmount           Decimal       @db.Decimal(10, 2)
  remainingAmount       Decimal       @db.Decimal(10, 2)
  currency              String        @default("USD")
  status                DepositStatus @default(PENDING)
  paymentMethod         String?
  stripePaymentIntentId String?
  stripeSessionId       String?
  depositLink           String        @unique
  depositLinkExpiresAt  DateTime
  paidAt                DateTime?
  refundedAt            DateTime?
  refundAmount          Decimal?      @db.Decimal(10, 2)
  refundReason          String?
  notes                 String?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  allowFullPayment      Boolean       @default(false)
  collectInPerson       Boolean       @default(false)
  client                Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  user                  User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([userId])
  @@index([depositLink])
  @@index([status])
  @@map("deposit_payments")
}

model TeamMessage {
  id          String    @id @default(cuid())
  senderId    String
  recipientId String
  subject     String?
  message     String
  isRead      Boolean   @default(false)
  readAt      DateTime?
  createdAt   DateTime  @default(now())
  isArchived  Boolean   @default(false)
  isDeleted   Boolean   @default(false)
  recipient   User      @relation("ReceivedMessages", fields: [recipientId], references: [id], onDelete: Cascade)
  sender      User      @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([recipientId])
  @@index([isRead])
  @@index([isDeleted])
  @@index([isArchived])
  @@index([createdAt])
  @@map("team_messages")
}

model DataDeletionRequest {
  id          String         @id @default(cuid())
  email       String
  reason      String?
  status      DeletionStatus @default(PENDING)
  requestedAt DateTime       @default(now())
  completedAt DateTime?
  notes       String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([email])
  @@index([status])
  @@map("data_deletion_requests")
}

model MarketingConnection {
  id            String   @id @default(cuid())
  userId        String
  platform      String
  accountId     String?
  accountName   String?
  accessToken   String
  refreshToken  String?
  tokenMetaJson String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([userId, platform])
  @@index([userId])
  @@map("marketing_connections")
}

model MarketingLead {
  id        String   @id @default(cuid())
  email     String
  name      String?
  phone     String?
  company   String?
  plan      String
  notes     String?
  createdAt DateTime @default(now())
  source    String   @default("website")
  status    String   @default("new")

  @@index([email])
  @@index([status])
  @@index([source])
  @@map("marketing_leads")
}

model MarketingSync {
  id        String   @id @default(cuid())
  platform  String
  status    String
  lastSync  DateTime
  notes     String?
  createdAt DateTime @default(now())

  @@index([platform])
  @@index([status])
  @@map("marketing_syncs")
}

model CommissionTransaction {
  id               String    @id @default(cuid())
  ownerId          String
  staffId          String
  appointmentId    String?
  amount           Float
  commissionRate   Float
  commissionAmount Float
  ownerAmount      Float
  employmentType   String
  status           String    @default("pending")
  paidAt           DateTime?
  paidMethod       String?
  notes            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  gratuityAmount   Float     @default(0)
  staffTotalAmount Float?

  @@index([ownerId])
  @@index([staffId])
  @@index([status])
  @@index([createdAt])
  @@map("commission_transactions")
}

model Appointment {
  id            String      @id @default(cuid())
  userId        String
  clientId      String
  title         String
  serviceType   String
  duration      Int
  startTime     DateTime
  endTime       DateTime
  status        String      @default("scheduled")
  price         Float?
  deposit       Float?
  paymentStatus String      @default("pending")
  source        String      @default("booking")
  bookingUrl    String?
  notes         String?
  reminderSent  Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  client        Client      @relation(fields: [clientId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  procedures    Procedure[]

  @@index([userId])
  @@index([clientId])
  @@index([startTime])
  @@index([status])
  @@map("appointments")
}

model Service {
  id              String              @id @default(cuid())
  userId          String
  name            String
  description     String?
  defaultDuration Int
  defaultPrice    Float
  category        String
  isActive        Boolean             @default(true)
  imageUrl        String?
  isCustomImage   Boolean             @default(false)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  procedures      Procedure[]
  assignments     ServiceAssignment[]
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([isActive])
  @@map("services")
}

model ServiceAssignment {
  id             String   @id @default(cuid())
  serviceId      String
  userId         String
  assigned       Boolean  @default(true)
  assignedBy     String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  assignedByUser User     @relation("AssignedByUser", fields: [assignedBy], references: [id], onDelete: Cascade)
  service        Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  user           User     @relation("UserServiceAssignments", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([serviceId, userId])
  @@index([userId])
  @@index([serviceId])
  @@index([assignedBy])
  @@map("service_assignments")
}

model ConsentForm {
  id                  String    @id @default(cuid())
  userId              String?
  clientId            String?
  procedureType       String?   @default("")
  clientSignature     String?
  clientSignatureDate DateTime?
  artistSignature     String?
  artistSignatureDate DateTime?
  medicalHistory      String?
  allergies           String?
  medications         String?
  skinConditions      String?
  previousProcedures  String?
  consentGiven        Boolean   @default(true)
  photographyConsent  Boolean   @default(false)
  marketingConsent    Boolean   @default(false)
  emergencyContact    String?
  additionalNotes     String?
  formVersion         String    @default("1.0")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  artistEmail         String?
  clientName          String
  completedAt         DateTime?
  contactInfo         String?
  customMessage       String?
  expiresAt           DateTime
  formData            Json?
  formType            String
  pdfUrl              String?
  sendMethod          String    @default("email")
  sentAt              DateTime  @default(now())
  status              String    @default("sent")
  token               String    @unique
  client              Client?   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  user                User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([clientId])
  @@index([token])
  @@index([status])
  @@index([createdAt])
  @@map("consent_forms")
}

model SupportTicket {
  id          String   @id @default(cuid())
  title       String
  description String
  status      String   @default("open")
  priority    String   @default("medium")
  category    String   @default("general")
  userId      String?
  createdBy   String
  assignedTo  String?
  resolution  String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User?    @relation(fields: [userId], references: [id])

  @@index([status])
  @@index([priority])
  @@index([createdBy])
  @@index([assignedTo])
  @@map("support_tickets")
}

model Complaint {
  id          String   @id @default(cuid())
  subject     String
  description String
  status      String   @default("new")
  priority    String   @default("medium")
  category    String   @default("general")
  userId      String?
  reportedBy  String
  assignedTo  String?
  resolution  String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User?    @relation(fields: [userId], references: [id])

  @@index([status])
  @@index([priority])
  @@index([reportedBy])
  @@index([assignedTo])
  @@map("complaints")
}

model InventoryItem {
  id           String   @id @default(cuid())
  name         String
  category     String
  brand        String?
  sku          String?
  currentStock Int      @default(0)
  minStock     Int?
  maxStock     Int?
  unitCost     Float    @default(0)
  totalValue   Float    @default(0)
  status       String   @default("in_stock")
  description  String?
  location     String?
  supplier     String?
  lastUpdated  DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category])
  @@index([status])
  @@index([brand])
  @@map("inventory_items")
}

model Meta {
  key   String @id
  value String

  @@map("meta")
}

model Product {
  id            String      @id @default(cuid())
  userId        String
  name          String
  description   String?
  price         Float
  category      String?
  sku           String?
  stockQuantity Int         @default(0)
  isDigital     Boolean     @default(false)
  images        String      @default("[]")
  isActive      Boolean     @default(true)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  orderItems    OrderItem[]
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([isActive])
  @@map("products")
}

model Order {
  id                String      @id @default(cuid())
  userId            String
  clientId          String?
  clientEmail       String?
  clientName        String?
  clientPhone       String?
  totalAmount       Float
  fulfillmentMethod String      @default("pickup")
  shippingAddress   String?
  status            String      @default("pending")
  notes             String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  orderItems        OrderItem[]
  client            Client?     @relation(fields: [clientId], references: [id])
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@map("orders")
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Float
  createdAt DateTime @default(now())
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model Portfolio {
  id          String   @id @default(cuid())
  userId      String
  type        String
  title       String
  description String?
  beforeImage String?
  afterImage  String?
  isPublic    Boolean  @default(true)
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isPublic])
  @@map("portfolios")
}

model FormDraft {
  id         String   @id @default(cuid())
  userId     String?
  clientId   String?
  formType   String
  formData   String
  isComplete Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  client     Client?  @relation(fields: [clientId], references: [id], onDelete: Cascade)
  user       User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([clientId])
  @@index([formType])
  @@map("form_drafts")
}

model FileUpload {
  id          String   @id @default(cuid())
  userId      String?
  clientId    String?
  fileName    String
  fileUrl     String
  fileType    String
  fileSize    Int
  mimeType    String
  isTemporary Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  client      Client?  @relation(fields: [clientId], references: [id], onDelete: Cascade)
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  weekVideoAssignments WeekVideoAssignment[]
  assignmentVideos    TrainingAssignment[]

  @@index([userId])
  @@index([clientId])
  @@index([fileType])
  @@index([isTemporary])
  @@map("file_uploads")
}

model Invoice {
  id              String        @id @default(cuid())
  userId          String
  clientId        String?
  invoiceNumber   String        @unique
  title           String
  providerName    String
  memo            String?
  subtotal        Float         @default(0)
  taxRate         Float         @default(0)
  taxAmount       Float         @default(0)
  total           Float         @default(0)
  status          String        @default("draft")
  dueDate         DateTime?
  paymentSchedule String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  items           InvoiceItem[]
  client          Client?       @relation(fields: [clientId], references: [id])
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([clientId])
  @@index([status])
  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  type        String
  name        String
  description String?
  quantity    Int      @default(1)
  unitPrice   Float
  total       Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_items")
}

model Notification {
  id             String   @id @default(cuid())
  userId         String
  type           String
  title          String
  message        String
  isRead         Boolean  @default(false)
  priority       String   @default("medium")
  actionRequired Boolean  @default(false)
  metadata       Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Review {
  id           String      @id @default(cuid())
  userId       String
  clientId     String?
  clientName   String
  clientEmail  String?
  service      String
  rating       Int
  comment      String?
  platform     String      @default("website")
  status       String      @default("pending")
  reviewLinkId String?
  createdAt    DateTime    @default(now())
  publishedAt  DateTime?
  updatedAt    DateTime    @updatedAt
  client       Client?     @relation(fields: [clientId], references: [id])
  reviewLink   ReviewLink? @relation(fields: [reviewLinkId], references: [id])
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("reviews")
}

model ReviewLink {
  id        String   @id @default(cuid())
  userId    String
  name      String
  url       String   @unique
  service   String
  sentTo    Int      @default(0)
  responses Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviews   Review[]

  @@map("review_links")
}

model TimeBlock {
  id               String   @id @default(cuid())
  userId           String
  date             String
  startTime        String
  endTime          String
  type             String
  title            String
  notes            String?
  isRecurring      Boolean  @default(false)
  recurringPattern String?
  recurringEndDate String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([date])
  @@index([userId, date])
  @@map("time_blocks")
}

model TimeTrackingSession {
  id            String         @id @default(cuid())
  userId        String
  clockInTime   DateTime
  clockOutTime  DateTime?
  totalHours    Float?
  location      String?
  lat           Float?
  lng           Float?
  notes         String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  breakSessions BreakSession[]
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([clockInTime])
  @@index([userId, clockInTime])
  @@map("time_tracking_sessions")
}

model BreakSession {
  id        String              @id @default(cuid())
  sessionId String
  startTime DateTime
  endTime   DateTime?
  duration  Float?
  reason    String?
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  session   TimeTrackingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@map("break_sessions")
}

model StudioSettings {
  id         String   @id @default(cuid())
  studioName String   @unique
  ownerEmail String
  address    String
  lat        Float
  lng        Float
  radius     Float    @default(100)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  updatedBy  String?

  @@index([studioName])
  @@index([ownerEmail])
  @@map("studio_settings")
}

enum DocumentType {
  ID_DOCUMENT
  CONSENT_FORM
  WAIVER
  INTAKE_FORM
  CONTRAINDICATION_FORM
  ANALYSIS_REPORT
  PHOTO
  OTHER
}

enum CalendarProvider {
  CALENDLY
  ACUITY_SCHEDULING
  GOOGLE_CALENDAR
  OUTLOOK_CALENDAR
  BOOKLY
  SIMPLYBOOK_ME
  CUSTOM
}

enum SyncDirection {
  IMPORT_ONLY
  EXPORT_ONLY
  BIDIRECTIONAL
}

enum DepositStatus {
  PENDING
  PAID
  EXPIRED
  REFUNDED
  CANCELLED
}

enum DeletionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum FulfillmentMethod {
  pickup
  delivery
  shipping
}

enum OrderStatus {
  pending
  confirmed
  processing
  shipped
  delivered
  cancelled
}

enum Stage {
  LEAD
  TOUR_SCHEDULED
  TOURED
  APP_STARTED
  APP_SUBMITTED
  ENROLLED
  NO_SHOW
  NURTURE
}

model Staff {
  id             String          @id @default(cuid())
  name           String
  email          String          @unique
  phone          String?
  role           String
  contacts       Contact[]       @relation("StaffContacts")
  tasks          Task[]
  interactions   Interaction[]
  tours          Tour[]          @relation("StaffTours")
  bookings       ClientBooking[] @relation("StaffBookings")
  emailTemplates EmailTemplate[] @relation("StaffEmailTemplates")
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
}

model Contact {
  id           String          @id @default(cuid())
  firstName    String
  lastName     String
  email        String?         @unique
  phone        String?
  source       String?
  tags         String[]
  stage        Stage           @default(LEAD)
  ownerId      String?
  owner        Staff?          @relation("StaffContacts", fields: [ownerId], references: [id])
  interactions Interaction[]
  tours        Tour[]
  applications Application[]
  enrollments  Enrollment[]
  consents     Consent[]
  tasks        Task[]
  bookings     ClientBooking[] @relation("ContactBookings")
  score        Int             @default(0)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
}

model Interaction {
  id        String   @id @default(cuid())
  type      String
  direction String
  subject   String?
  body      String?
  meta      Json?
  contactId String
  contact   Contact  @relation(fields: [contactId], references: [id])
  staffId   String?
  staff     Staff?   @relation(fields: [staffId], references: [id])
  createdAt DateTime @default(now())
}

model Task {
  id        String    @id @default(cuid())
  title     String
  dueAt     DateTime?
  status    String    @default("OPEN")
  contactId String?
  contact   Contact?  @relation(fields: [contactId], references: [id])
  ownerId   String
  owner     Staff     @relation(fields: [ownerId], references: [id])
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Tour {
  id        String   @id @default(cuid())
  start     DateTime
  end       DateTime
  location  String
  status    String   @default("SCHEDULED")
  contactId String
  contact   Contact  @relation(fields: [contactId], references: [id])
  staffId   String?
  staff     Staff?   @relation("StaffTours", fields: [staffId], references: [id])
  notes     String?
  createdAt DateTime @default(now())
}

model ClientBooking {
  id            String   @id @default(cuid())
  clientName    String
  bookingType   String // "licensed_artist" | "student" | "intro_session"
  bookingDate   DateTime
  procedureDate DateTime
  status        String   @default("scheduled") // "scheduled" | "showed" | "no_show" | "cancelled"
  isPromo       Boolean  @default(false)
  notes         String?
  contactId     String?
  contact       Contact? @relation("ContactBookings", fields: [contactId], references: [id], onDelete: SetNull)
  staffId       String?
  staff         Staff?   @relation("StaffBookings", fields: [staffId], references: [id], onDelete: SetNull)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([bookingDate])
  @@index([procedureDate])
  @@index([status])
  @@index([contactId])
  @@map("client_bookings")
}

model Application {
  id          String   @id @default(cuid())
  contactId   String
  contact     Contact  @relation(fields: [contactId], references: [id])
  status      String   @default("STARTED")
  missingDocs String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Enrollment {
  id          String   @id @default(cuid())
  contactId   String
  contact     Contact  @relation(fields: [contactId], references: [id])
  cohort      String
  depositPaid Boolean  @default(false)
  tuitionPlan String?
  createdAt   DateTime @default(now())
}

model Consent {
  id        String   @id @default(cuid())
  contactId String
  contact   Contact  @relation(fields: [contactId], references: [id])
  channel   String
  status    String
  timestamp DateTime @default(now())
  ip        String?
  source    String?
}

model EmailTemplate {
  id        String   @id @default(cuid())
  name      String
  subject   String
  body      String
  staffId   String
  staff     Staff    @relation("StaffEmailTemplates", fields: [staffId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([staffId])
  @@map("email_templates")
}
